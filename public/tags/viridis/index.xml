<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>viridis on %&gt;% dreams</title>
    <link>/tags/viridis/</link>
    <description>Recent content in viridis on %&gt;% dreams</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 03 May 2020 00:00:00 +0000</lastBuildDate><atom:link href="/tags/viridis/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Creating an R Package for School District Shapefiles</title>
      <link>/blog/leaid-shapefiles/</link>
      <pubDate>Sun, 03 May 2020 00:00:00 +0000</pubDate>
      
      <guid>/blog/leaid-shapefiles/</guid>
      <description>


&lt;p&gt;I would like to introduce &lt;a href=&#34;https://github.com/ivelasq/leaidr&#34;&gt;{leaidr}&lt;/a&gt;, a package for mapping U.S. School District shapefiles!&lt;/p&gt;
&lt;p&gt;Inspired by my coauthor &lt;a href=&#34;https://joshuamrosenberg.com/&#34;&gt;Joshua Rosenberg&lt;/a&gt;, the goal of {leaidr} is to facilitate the download and use of school district shapefiles.&lt;/p&gt;
&lt;p&gt;School districts in the U.S. have associated local education agency identification numbers (LEAID) used in the &lt;a href=&#34;https://nces.ed.gov/pubs2010/100largest0809/tables/table_d05.asp&#34;&gt;National Center for Education Statistics (NCES) Common Core of Data&lt;/a&gt;. These are very useful because if you have other datasets with NCES ID’s, then you can (sometimes easily) join them.&lt;/p&gt;
&lt;p&gt;It can be very useful to visualize districts and associated data. District shapefiles are available in different places, such as through the &lt;a href=&#34;https://nces.ed.gov/programs/edge/Geographic/DistrictBoundaries&#34;&gt;NCES&lt;/a&gt; and &lt;a href=&#34;https://exhibits.stanford.edu/data/catalog/db586ns4974&#34;&gt;Stanford Education Data Archive&lt;/a&gt;. The package {tigris} also has a school district option, but unfortunately it is missing a few district polygons.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tigris)

ca &amp;lt;- tigris::school_districts(state = &amp;quot;06&amp;quot;,
                               type = &amp;quot;unified&amp;quot;)

plot(ca[&amp;quot;GEOID&amp;quot;])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/blog/leaid-shapefiles_files/figure-html/unnamed-chunk-1-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;{leaidr} downloads NCES’ U.S. district shapefile from Github using ROpenSci’s &lt;a href=&#34;https://github.com/ropensci/piggyback&#34;&gt;{piggyback}&lt;/a&gt; package. This is a super helpful package, as Github caps file uploads at 100 MB (and the shapefile is ~170 MB). I originally tried Github Large File Storage (LFS), but it stores files as a hash, not as an actual file. Therefore, I couldn’t figure out how to use it for a package that others can use.&lt;/p&gt;
&lt;p&gt;The function &lt;code&gt;lea_get()&lt;/code&gt; downloads an R Data file from the Github repo to your designated path and then writes the necessary shapefiles. Then, create an object with &lt;code&gt;lea_prep()&lt;/code&gt; by designating where the shapefiles exist and which state(s) you would like. &lt;strong&gt;Note:&lt;/strong&gt; For now, you must use the state’s FIPS code. FIPS state codes are numeric and two-letter alphabetic codes to identify U.S. states and certain other associated areas. A reference table is found &lt;a href=&#34;https://www.mcc.co.mercer.pa.us/dps/state_fips_code_listing.htm&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once you have the shapefile, then you can merge with other datasets and plot using packages like {leaflet} and {ggplot2}.&lt;/p&gt;
&lt;div id=&#34;example&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Example&lt;/h2&gt;
&lt;p&gt;Let’s walk through an example where we will merge external data to the shapefile and then map all the districts in California. The external data is from Josh’s &lt;a href=&#34;https://github.com/making-data-science-count/covidedu&#34;&gt;&lt;code&gt;covidedu&lt;/code&gt; project&lt;/a&gt;, which scrapes district websites for specific words. In this case, the search terms were “covid*”, “coron*”, and “closure”. I highly recommend using &lt;code&gt;covidedu&lt;/code&gt; for easy scraping from a &lt;strong&gt;lot&lt;/strong&gt; of district websites!&lt;/p&gt;
&lt;p&gt;First, let’s call our libraries.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
# if you haven&amp;#39;t installed the package yet
# devtools::install_github(&amp;quot;ivelasq/leaidr&amp;quot;)
library(leaidr)
library(maptools)
library(viridis)
# if you don&amp;#39;t have this downloaded
# install.packages(&amp;quot;mapproj&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Time to get your data! Use {leaidr} to download and prep your shapefiles for California (FIPS == 06). Read in the external data (in this case, &lt;code&gt;summary-of-table-of-links.csv&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; You must have a GitHub PAT set to run &lt;code&gt;lea_get()&lt;/code&gt;. &lt;a href=&#34;https://happygitwithr.com/github-pat.html&#34;&gt;Happy git with R&lt;/a&gt; has a great walkthrough on how to do that.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# download the shapefile into a designated folder
leaidr::lea_get(path = &amp;quot;./test&amp;quot;)

# prep the shapefile for the state(s) you&amp;#39;d like
ca_shapefile &amp;lt;-
  leaidr::lea_prep(path = &amp;quot;./test&amp;quot;, fips = &amp;quot;06&amp;quot;)

# read in the external data that also has NCES ID&amp;#39;s
# this is from the covidedu project
ca_data &amp;lt;-
  read_csv(&amp;quot;https://raw.githubusercontent.com/making-data-science-count/covidedu/master/output/2020-04-29/summary-of-table-of-links.csv&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Join the CSV to the shapefile.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ca_merge &amp;lt;-
  sp::merge(ca_shapefile, ca_data, by.x = &amp;quot;GEOID&amp;quot;, by.y = &amp;quot;nces_id&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now ‘fortify’ the data - this converts the polygons into points. This is so ggplot can create the plot.&lt;/p&gt;
&lt;p&gt;If you get the error &lt;code&gt;isTRUE(gpclibPermitStatus()) is not TRUE&lt;/code&gt;, then you need to enable &lt;code&gt;gpclib&lt;/code&gt; by running &lt;code&gt;gpclibPermit()&lt;/code&gt; (this is part of the {maptools} package, which should have been loaded above). Note that support for &lt;code&gt;gpclib&lt;/code&gt; will be withdrawn from maptools at the next major release, so you might have to try something else if the package has been upgraded.&lt;/p&gt;
&lt;p&gt;If you run &lt;code&gt;gpclibPermit()&lt;/code&gt; and you keep getting &lt;code&gt;FALSE&lt;/code&gt;, then you are missing the package {gpclib}. Install the package, then run &lt;code&gt;gpclibPermit()&lt;/code&gt; to set it to &lt;code&gt;TRUE&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;(I don’t know if this is the best/only way to do this - if anybody has suggestions, please let me know!)&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# install.package(&amp;quot;gpclib&amp;quot;)
gpclibPermit()
ca_points &amp;lt;- fortify(ca_merge, region = &amp;quot;GEOID&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now, join the points and the shapefile data.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ca_df &amp;lt;- left_join(ca_merge@data, ca_points, by = c(&amp;quot;GEOID&amp;quot; = &amp;quot;id&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can finally plot the shapefile and its data!&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ca_map &amp;lt;-
  ca_df %&amp;gt;% 
  ggplot() +
  geom_polygon(aes(x = long, 
                   y = lat, 
                   group = group,
                   fill = any_link_found),
               color = &amp;quot;gray&amp;quot;, 
               size = .2) +
  theme_void() +
  scale_fill_viridis(option = &amp;quot;cividis&amp;quot;, discrete = TRUE) +
  ggtitle(&amp;quot;COVID-Related Links Found on CA School District Sites&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To make a nicer looking map, then you can use &lt;code&gt;coord_map()&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;map_projected &amp;lt;- ca_map +
  coord_map()

print(map_projected)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://ivelasq.rbind.io/img/leaid-shapefiles/test_map.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Tada! A full school district map for California.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;call-for-collaboration&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Call for Collaboration&lt;/h2&gt;
&lt;p&gt;Please try out {leaidr}! I hope that it is useful to you in your work. I’d love any collaborators to join me in making it easier/better!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Other functionalities&lt;/strong&gt;: Thinking of: being able to filter shapefiles by NCES IDs as well as states; adding commonly used data (like district demographics).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Issues&lt;/strong&gt;: If you run into any issues, please post on the &lt;a href=&#34;https://github.com/ivelasq/leaidr/issues&#34;&gt;GitHub page!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;resources&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#%20joining%20spatial%20data:%20http://www.nickeubank.com/wp-content/uploads/2015/10/RGIS2_MergingSpatialData_part1_Joins.html&#34;&gt;&lt;strong&gt;Joining Spatial Data&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rpubs.com/DanielSLee/censusMap&#34;&gt;&lt;strong&gt;Analyzing U.S. Census Data Using R&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Disaggregating Minneapolis Public Schools Data</title>
      <link>/blog/why-disaggregate-data/</link>
      <pubDate>Fri, 21 Sep 2018 00:00:00 +0000</pubDate>
      
      <guid>/blog/why-disaggregate-data/</guid>
      <description>&lt;p&gt;Although this post heavily references education and student data, the principle of using distributions is paramount in any field that strives to close equity gaps.&lt;/p&gt;
&lt;div id=&#34;what-is-equity&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What is Equity&lt;/h2&gt;
&lt;p&gt;Inequities are &lt;a href=&#34;http://www.yourdictionary.com/racial-inequality&#34;&gt;disparities in opportunity, resources, and treatment.&lt;/a&gt; Racial and socioeconomic inequities are those that are as a result of one’s race or socioeconomic status. The unequal distribution of opportunity, resource, and treatment can be due to many factors, including patterns in society. &lt;a href=&#34;https://www.allsides.com/dictionary/racial-inequity&#34;&gt;Examples include:&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Racial attitudes/bias that act subtly to undermine and exclude,&lt;/li&gt;
&lt;li&gt;Continued redlining in lending,&lt;/li&gt;
&lt;li&gt;Embedded biases in education (images, language, school discipline),&lt;/li&gt;
&lt;li&gt;Long term ramifications of poor health/healthcare.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Because the definition of equity varies from team to team, it is important to decide which inequities to identify and focus on.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;what-is-disaggregated-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;What Is Disaggregated Data&lt;/h2&gt;
&lt;p&gt;According to the &lt;a href=&#34;https://www.edglossary.org/disaggregated-data/&#34;&gt;Glossary of Education Reform&lt;/a&gt;, the formal definition of disaggregated data is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Disaggregated data refers to numerical or non-numerical information that has been (1) collected from multiple sources and/or on multiple measures, variables, or individuals; (2) compiled into aggregate data—i.e., summaries of data—typically for the purposes of public reporting or statistical analysis; and then (3) broken down in component parts or smaller units of data.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Aggregate population numbers are broken down into smaller groupings that analysts can compare and contrast. These groupings depend on your team’s definition of equity, whether it be focused on race, socioeconomic status, race AND socioeconomic status, age, ethnicity, etc.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;why-use-disaggregated-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Why Use Disaggregated Data&lt;/h2&gt;
&lt;p&gt;Particularly in education, disaggregated data is essential in identifying where solutions are needed to solve inequities. Per NCES’ &lt;a href=&#34;https://nces.ed.gov/pubsearch/pubsinfo.asp?pubid=NFES2017017&#34;&gt;Forum Guide to Collecting and Using Disaggregated Data on Racial/Ethnic Subgroups&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Educators need both high-level data summaries as well as disaggregated data that accurately describe smaller groups of students they serve. Access to and analysis of more detailed data—that is, disaggregated data—can be a useful tool for improving educational outcomes for small groups of students who otherwise would not be distinguishable in the aggregated data used for federal reporting. Disaggregating student data into subpopulations can help schools and communities plan appropriate programs; decide which interventions to implement; target limited resources; and recognize trends in educational participation, outcomes, and achievement.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div id=&#34;minneapolis-public-schools-example&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Minneapolis Public Schools Example&lt;/h2&gt;
&lt;p&gt;Minneapolis Public Schools (MPS) reports their student demographics in a robust, complete way. Not only do they report the percentage of students in a subgroup, but they also include the number of students in each subgroup. This allows a deep look into their individual school demographics and gives us the opportunity to explore equity in their district.&lt;/p&gt;
&lt;div id=&#34;pulling-data&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Pulling Data&lt;/h3&gt;
&lt;p&gt;All code to pull MPS data is included in the code appendix. MPS has moved to publishing their school data in PDFs. Thankfully, the &lt;code&gt;tabulizer&lt;/code&gt; package exists! It easily and quickly pulled the data into lists which I then transformed to data frames and tidied up.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;first-glance-mps-district-demographics&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;First Glance: MPS District Demographics&lt;/h3&gt;
&lt;p&gt;Here is a barplot which shows the percentage of different subgroups in the school district. FRPL stands for Free/Reduced Price Lunch, often used as a proxy for poverty. Students from a household with an income up to 185 percent of the poverty threshold are eligible for free or reduced price lunch. (Sidenote: Definitions are very important in disaggregated data. FRPL is used because it’s ubiquitous and reporting is mandated but &lt;a href=&#34;https://nces.ed.gov/blogs/nces/post/free-or-reduced-price-lunch-a-proxy-for-poverty&#34;&gt;there is debate as to whether it actually reflects the level of poverty among students&lt;/a&gt;.)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/blog/why-disaggregate-data_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;When we look at these data, MPS looks like a diverse school district. Almost &lt;strong&gt;40% of students are Black&lt;/strong&gt; and around &lt;strong&gt;35% are White&lt;/strong&gt;. &lt;strong&gt;60% of the students are eligible for FRPL&lt;/strong&gt;, which is &lt;a href=&#34;https://nces.ed.gov/programs/digest/d17/tables/dt17_204.10.asp?current=yes&#34;&gt;high for Minnesota but close to the US average of 52.1%&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;However, let’s explore if there’s more to this story.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;discover-distributions&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Discover Distributions&lt;/h3&gt;
&lt;p&gt;Another view of the data can be visualizing the distribution of percentage of a demographic within schools. Here is a histogram for the percentage of White students within the 74 MPS schools for which we have data.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/blog/why-disaggregate-data_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;27 of the 74 (36%) of schools have between 0-10% White students.&lt;/strong&gt; This implies that even though the school district may be diverse, the demographics are not evenly distributed across the schools. More than half of schools enroll fewer than 30% of White students even though White students make up 35% of the district student population.&lt;/p&gt;
&lt;p&gt;The school race demographics are not representative of the district populations but does that hold for socioeconomic status as well?&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;create-categories&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Create Categories&lt;/h3&gt;
&lt;p&gt;High-poverty schools are defined as public schools where more than 75% of the students are eligible for FRPL. According to NCES, &lt;a href=&#34;https://nces.ed.gov/fastfacts/display.asp?id=898&#34;&gt;24% of public school students attended high-poverty schools&lt;/a&gt;. However, different subgroups were overrepresented and underrepresented within the high poverty schools. Is this the case for MPS?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/blog/why-disaggregate-data_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;9% of White students&lt;/strong&gt; attend high poverty schools, compared to &lt;strong&gt;46% of Black students&lt;/strong&gt;, &lt;strong&gt;51% of Hispanic students&lt;/strong&gt;, &lt;strong&gt;46% of Asian students&lt;/strong&gt;, and &lt;strong&gt;49% of Native American students&lt;/strong&gt;. These students are disproportionally attending high poverty schools.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;reveal-relationships&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Reveal Relationships&lt;/h3&gt;
&lt;p&gt;Let’s explore what happens when we correlate race and FRPL percentage by school.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/blog/why-disaggregate-data_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Similarly to the result above, &lt;strong&gt;there is a strong negative correlation between FRPL percentage and the percentage of white students in a school.&lt;/strong&gt; High poverty schools have a lower percentage of White students and low poverty schools have a higher percentage of White students.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;conclusion&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;According to the Urban Institute, the disproportionate percentage of students of color attending high poverty schools “is a defining feature of almost all Midwestern and northeastern metropolitan school systems.” Among other issues, high poverty schools &lt;a href=&#34;https://www.urban.org/urban-wire/high-poverty-schools-undermine-education-children-color&#34;&gt;tend to lack the educational resources—like highly qualified and experienced teachers, low student-teacher ratios, college prerequisite and advanced placement courses, and extracurricular activities—available in low-poverty schools.&lt;/a&gt; This has a huge impact on these students and their futures.&lt;/p&gt;
&lt;p&gt;Because of the disaggregated data Minneapolis Public Schools provides, we can go deeper than the average of demographics across the district and see what it looks like on the school level. These views display that (1) there exists a distribution of race/ethnicity within schools that are not representative of the district, (2) that students of color are overrepresented in high poverty schools, and (3) there is a relationship between the percentage of White students in a school and the percentage of students eligible for FRPL.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;amazing-examples-of-disaggregated-data-reporting&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Amazing Examples of Disaggregated Data Reporting&lt;/h2&gt;
&lt;p&gt;There are so many amazing examples out there using disaggregated data. These two are my favorites:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nytimes.com/interactive/2016/04/29/upshot/money-race-and-success-how-your-school-district-compares.html&#34;&gt;Money, Race and Success: How Your School District Compares&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.tampabay.com/projects/2015/investigations/pinellas-failure-factories/chart-failing-black-students/&#34;&gt;Why Pinellas County is the worst place in Florida to be black and go to public school&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;code-appendix&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Code Appendix&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
library(viridis)
library(tabulizer)
library(janitor)

# race data
race_pdf &amp;lt;-
  extract_tables(&amp;quot;http://studentaccounting.mpls.k12.mn.us/uploads/racial_ethnic_school_gradefall2017.pdf&amp;quot;)

race_df &amp;lt;- # many thanks to my brother @gvelasq for purrrifying this
  race_pdf %&amp;gt;%
  map(as_tibble) %&amp;gt;%
  map_df(~ slice(., -1:-2)) %&amp;gt;% 
  set_names(c(&amp;quot;school_group&amp;quot;, &amp;quot;school_name&amp;quot;, &amp;quot;grade&amp;quot;, &amp;quot;na_num&amp;quot;, &amp;quot;na_pct&amp;quot;, &amp;quot;aa_num&amp;quot;, &amp;quot;aa_pct&amp;quot;, &amp;quot;as_num&amp;quot;, &amp;quot;as_pct&amp;quot;, &amp;quot;hi_num&amp;quot;, &amp;quot;hi_pct&amp;quot;, &amp;quot;wh_num&amp;quot;, &amp;quot;wh_pct&amp;quot;, &amp;quot;pi_pct&amp;quot;, &amp;quot;blank_col&amp;quot;, &amp;quot;tot&amp;quot;))

race_filter &amp;lt;-
  race_df %&amp;gt;%
  select(-school_group, -grade, -pi_pct, -blank_col) %&amp;gt;% # unnecessary or blank columns
  filter(str_detect(school_name, &amp;quot;Total&amp;quot;),
         school_name != &amp;quot;Grand Total&amp;quot;) %&amp;gt;% # otherwise totals are duplicated
  mutate(school_name = str_replace(school_name, &amp;quot;Total&amp;quot;, &amp;quot;&amp;quot;)) %&amp;gt;% 
  mutate_if(is.character, trimws) 

# frpl data
frpl_pdf &amp;lt;-
  extract_tables(&amp;quot;http://studentaccounting.mpls.k12.mn.us/uploads/free_reduced_meal_fall_2017.pdf&amp;quot;)

frpl_df &amp;lt;- # many thanks to my brother @gvelasq for purrrifying this
  frpl_pdf %&amp;gt;%
  map(as_tibble) %&amp;gt;%
  map_df(~ slice(., -1)) %&amp;gt;%  
  set_names(c(&amp;quot;school_grades&amp;quot;, &amp;quot;school_name&amp;quot;, &amp;quot;total_students&amp;quot;, &amp;quot;frpl_pct&amp;quot;, &amp;quot;free_num&amp;quot;, &amp;quot;reduce_num&amp;quot;, &amp;quot;not_eligible_num&amp;quot;))

frpl_filter &amp;lt;-
  frpl_df %&amp;gt;% 
  filter(school_name != &amp;quot;&amp;quot;) %&amp;gt;%
  select(-school_grades)

# merged data
merged_df &amp;lt;-
  left_join(race_filter, frpl_filter, by = c(&amp;quot;school_name&amp;quot;)) %&amp;gt;% 
  mutate_at(2:17, as.numeric) %&amp;gt;%
  mutate(frpl_pct = (free_num + reduce_num)/total_students,
         hi_povnum = case_when(frpl_pct &amp;gt; .75 ~ hi_num),
         aa_povnum = case_when(frpl_pct &amp;gt; .75 ~ aa_num),
         wh_povnum = case_when(frpl_pct &amp;gt; .75 ~ wh_num),
         as_povnum = case_when(frpl_pct &amp;gt; .75 ~ as_num),
         na_povnum = case_when(frpl_pct &amp;gt; .75 ~ na_num)) %&amp;gt;%
  adorn_totals() %&amp;gt;%
  mutate(na_pct = na_num/tot,
         aa_pct = aa_num/tot,
         as_pct = as_num/tot,
         hi_pct = hi_num/tot,
         wh_pct = wh_num/tot,
         frpl_pct = (free_num + reduce_num)/total_students, # otherwise total frpl_pct is off
         hi_povsch = hi_povnum/hi_num[which(school_name == &amp;quot;Total&amp;quot;)],
         aa_povsch = aa_povnum/aa_num[which(school_name == &amp;quot;Total&amp;quot;)],
         as_povsch = as_povnum/as_num[which(school_name == &amp;quot;Total&amp;quot;)],
         wh_povsch = wh_povnum/wh_num[which(school_name == &amp;quot;Total&amp;quot;)],
         na_povsch = na_povnum/na_num[which(school_name == &amp;quot;Total&amp;quot;)])

# tidy data
tidy_df &amp;lt;-
  merged_df %&amp;gt;%
  gather(category, value, -school_name)

# this is so I do not have to run the code above constantly
tidy_df &amp;lt;- read_csv(here::here(&amp;quot;content&amp;quot;, &amp;quot;blog&amp;quot;, &amp;quot;why_disaggregate_data_files&amp;quot;, &amp;quot;tidy_df.csv&amp;quot;))
merged_df &amp;lt;- read_csv(here::here(&amp;quot;content&amp;quot;, &amp;quot;blog&amp;quot;, &amp;quot;why_disaggregate_data_files&amp;quot;, &amp;quot;merged_df.csv&amp;quot;))
# demographic barplot
tidy_df %&amp;gt;%
  filter(school_name == &amp;quot;Total&amp;quot;,
         str_detect(category, &amp;quot;pct&amp;quot;)) %&amp;gt;% 
  mutate(category = factor(category, levels = c(&amp;quot;aa_pct&amp;quot;, &amp;quot;wh_pct&amp;quot;, &amp;quot;hi_pct&amp;quot;, &amp;quot;as_pct&amp;quot;, &amp;quot;na_pct&amp;quot;, &amp;quot;frpl_pct&amp;quot;))) %&amp;gt;%  
  ggplot(aes(x = category, y = value)) +
  geom_bar(stat = &amp;quot;identity&amp;quot;, aes(fill = factor(category))) +
  xlab(&amp;quot;Subgroup&amp;quot;) +
  ylab(&amp;quot;Percentage of Population&amp;quot;) +
  scale_x_discrete(labels = c(&amp;quot;Black&amp;quot;, &amp;quot;White&amp;quot;, &amp;quot;Hispanic&amp;quot;, &amp;quot;Asian&amp;quot;, &amp;quot;Native Am.&amp;quot;, &amp;quot;FRPL&amp;quot;)) +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_viridis(option = &amp;quot;cividis&amp;quot;, discrete = T) +
  theme_minimal() +
  theme(legend.position = &amp;quot;none&amp;quot;)

# histogram
merged_df %&amp;gt;% 
  filter(school_name != &amp;quot;Total&amp;quot;) %&amp;gt;% 
  ggplot(aes(x = wh_pct)) +
  geom_histogram(fill = &amp;quot;slategray4&amp;quot;, breaks= seq(0, 1, by = .1)) +
  xlab(&amp;quot;White Percentage&amp;quot;) +
  ylab(&amp;quot;Count&amp;quot;) +
  scale_x_continuous(labels = scales::percent) +
  theme_minimal() +
  theme(legend.position = &amp;quot;none&amp;quot;)

# histogram info
histinfo &amp;lt;- hist(merged_df$wh_pct)
histinfo

# high poverty barplot
tidy_df %&amp;gt;%
  filter(school_name == &amp;quot;Total&amp;quot;,
         str_detect(category, &amp;quot;povsch&amp;quot;)) %&amp;gt;% 
  mutate(category = factor(category, levels = c(&amp;quot;hi_povsch&amp;quot;, &amp;quot;na_povsch&amp;quot;, &amp;quot;aa_povsch&amp;quot;, &amp;quot;as_povsch&amp;quot;, &amp;quot;wh_povsch&amp;quot;))) %&amp;gt;%  
  ggplot(aes(x = category, y = value)) +
  geom_bar(stat = &amp;quot;identity&amp;quot;, aes(fill = factor(category))) +
  xlab(&amp;quot;Subgroup&amp;quot;) +
  ylab(&amp;quot;Percentage in High Poverty Schools&amp;quot;) +
  scale_x_discrete(labels = c(&amp;quot;Hispanic&amp;quot;, &amp;quot;Native Am.&amp;quot;, &amp;quot;Black&amp;quot;, &amp;quot;Asian&amp;quot;, &amp;quot;White&amp;quot;)) +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_viridis(option = &amp;quot;cividis&amp;quot;, discrete = T) +
  theme_minimal() +
  theme(legend.position = &amp;quot;none&amp;quot;)

# scatterplot
merged_df %&amp;gt;% 
  filter(school_name != &amp;quot;Total&amp;quot;) %&amp;gt;% 
  ggplot(aes(x = wh_pct, y = frpl_pct)) +
  geom_point(color = &amp;quot;slategray4&amp;quot;) +
  xlab(&amp;quot;White Percentage&amp;quot;) +
  ylab(&amp;quot;FRPL Percentage&amp;quot;) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent) +
  theme_minimal() +
  theme(legend.position = &amp;quot;none&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
